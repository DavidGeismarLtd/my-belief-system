<%
  # Dimension Card Partial
  # Displays a dimension with position indicator, stats, and optional explanation
  #
  # Required parameters:
  #   dimension_name (string) - The name of the dimension
  #   position (float) - The position value (-100 to 100)
  #   intensity (float) - The intensity value (0-100)
  #   confidence (float) - The confidence value (0-100)
  #
  # Optional parameters:
  #   left_pole (string) - Left pole label (default: "Left")
  #   right_pole (string) - Right pole label (default: "Right")
  #   explanation (string) - Explanation text (default: nil)
  #   show_lean (boolean) - Show lean direction stat (default: true)
%>

<%
  left_pole ||= "Left"
  right_pole ||= "Right"
  explanation ||= nil
  show_lean = true unless local_assigns.key?(:show_lean)

  # Calculate lean direction
  if position < -20
    lean_label = left_pole.split(' ').first
    lean_color = "blue"
  elsif position > 20
    lean_label = right_pole.split(' ').first
    lean_color = "red"
  else
    lean_label = "Balanced"
    lean_color = "gray"
  end

  # Calculate intensity label
  intensity_label = if intensity > 75
    "Strong"
  elsif intensity > 50
    "Moderate"
  else
    "Weak"
  end

  # Calculate confidence label
  confidence_label = if confidence > 80
    "High"
  elsif confidence > 60
    "Medium"
  else
    "Low"
  end

  # Calculate position percentage for slider
  position_percent = ((position + 100) / 2.0).round
%>

<div class="group bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg hover:shadow-xl border border-gray-100 hover:border-blue-200 p-6 sm:p-8 transition-all duration-300">
  <h3 class="text-xl font-bold text-gray-900 mb-5 flex items-center gap-3">
    <span class="text-2xl">üìä</span>
    <%= dimension_name %>
  </h3>

  <!-- Position Indicator -->
  <div class="mb-6">
    <div class="flex justify-between text-sm font-semibold text-gray-700 mb-3">
      <span class="text-left flex-1"><%= left_pole %></span>
      <span class="text-center px-4 text-gray-400">‚Üê</span>
      <span class="text-right flex-1"><%= right_pole %></span>
    </div>
    <div class="relative h-4 bg-gradient-to-r from-blue-100 via-gray-100 to-red-100 rounded-full shadow-inner">
      <div class="absolute top-1/2 -translate-y-1/2 w-6 h-6 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full shadow-lg ring-4 ring-white transition-transform duration-200 group-hover:scale-110"
           style="left: calc(<%= position_percent %>% - 12px)"></div>
    </div>
    <div class="text-center mt-2">
      <span class="inline-block px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-bold">
        Position: <%= position %>
      </span>
    </div>
  </div>

  <!-- Stats Grid -->
  <div class="grid <%= show_lean ? 'sm:grid-cols-3' : 'sm:grid-cols-2' %> gap-4 mb-5">
    <% if show_lean %>
      <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4 border border-purple-200 text-center">
        <div class="text-xs font-bold text-purple-900 mb-2">Lean</div>
        <div class="text-lg font-bold text-purple-700">
          <%= lean_label %>
        </div>
      </div>
    <% end %>
    <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 border border-blue-200 text-center">
      <div class="text-xs font-bold text-blue-900 mb-2">Intensity</div>
      <div class="text-lg font-bold text-blue-700">
        <%= intensity_label %>
        <span class="text-sm">(<%= (intensity / 100.0).round(2) %>)</span>
      </div>
    </div>
    <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4 border border-green-200 text-center">
      <div class="text-xs font-bold text-green-900 mb-2">Confidence</div>
      <div class="text-lg font-bold text-green-700">
        <%= confidence_label %>
        <span class="text-sm">(<%= (confidence / 100.0).round(2) %>)</span>
      </div>
    </div>
  </div>

  <!-- Explanation (optional) -->
  <% if explanation.present? %>
    <div class="bg-gradient-to-r from-blue-50 to-purple-50 border-l-4 border-blue-500 p-5 rounded-xl">
      <div class="flex items-start gap-3">
        <span class="text-xl flex-shrink-0">üí°</span>
        <div>
          <p class="text-sm font-semibold text-gray-900 mb-1">Why we think this:</p>
          <p class="text-sm text-gray-700 leading-relaxed">
            <%= explanation %>
          </p>
        </div>
      </div>
    </div>
  <% end %>
</div>
